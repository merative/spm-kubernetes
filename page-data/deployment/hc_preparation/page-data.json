{"componentChunkName":"component---src-pages-deployment-hc-preparation-mdx","path":"/deployment/hc_preparation/","result":{"pageContext":{"frontmatter":{"title":"Preparing Helm Charts","description":"Preparing Helm Charts"},"relativePagePath":"/deployment/hc_preparation.mdx","titleType":"page","MdxNode":{"id":"f70f02f9-e73e-56f2-870b-f2e1884f33f5","children":[],"parent":"ed790fde-0152-5f92-9dc5-58758ec723a4","internal":{"content":"---\ntitle: Preparing Helm Charts\ndescription: Preparing Helm Charts\n---\n\n<InlineNotification kind=\"info\">\n\n**Troubleshooting** If you need help troubleshooting problems, see [Troubleshooting problems](/troubleshooting/troubleshoot).\n\n</InlineNotification>\n\nThe [spm-kubernetes](https://github.com/merative/spm-kubernetes) repository provides the following Helm Charts:\n\n* *apps:* defines how to deploy the IBM速 WebSphere速 Liberty images with Merative Social Program Management (SPM).\n* *batch:* defines the batch image configuration.\n* *uawebapp:* defines how to deploy the Universal Access (React) application.\n* *web:* defines how to deploy the static content image for SPM (`Curam` image only).\n* *mqserver:* defines the IBM WebSphere MQ image configuration.\n* *xmlserver:* defines the xmlserver container configuration.\n* *spm:* an umbrella chart to contain all the other charts.\n\nThe charts use a templating mechanism to create the YAML file that is used by Kubernetes.\nFor this reason, the main configuration values are stored for each chart in a `values.yaml` file in the main folder of the charts.\nThe values can also be overwritten by the `spm:*` umbrella chart or by a provided override file during deployment as described in [Deploying Helm Charts](/deployment/hc_deployment).\n\nYAML is a human-readable structured data format. It provides powerful configuration settings, without having to learn a more complex code type like CSS, JavaScript, or PHP.\n\n## Preparing to run the Helm Charts\n\nBefore you run the charts, you must configure the database, configure IBM MQ, resolve all chart dependencies, and test the charts.\nYou may also optionally integrate your deployment with an ISAM server for SSO enablement,\nto do so complete the steps on the [Enabling ISAM](/supporting-infrastructure/ISAM) page under Supporting Infrastructure before returning here.\n\nMany of the Helm Charts that make up a deployment of SPM depend on the [IBM Shared Configuration Helpers](https://github.com/IBM/charts/tree/master/samples/ibm-sch) chart, so an extra Helm repository must be added using the following command:\n\n```shell\nhelm repo add sch https://raw.githubusercontent.com/IBM/charts/master/repo/samples\nhelm repo update\n```\n\n### Configuring the Helm Chart\n\nA catalog of available configuration options is available in the [Configuration Reference](/deployment/config-reference) topic.\n\nWhile you may change the values in your local copy of `helm-charts/spm/values.yaml`, it is strongly recommended to use a values override file with your custom options.\n\n<InlineNotification>\n\nSample override files for Minikube, AKS, and CRC are also available in the `$SPM_HOME/static/resources` folder. We have provided a minimum\nspec required for a successful deployment in these files, with more options for overriding commented out. The config options from the\n[Configuration Reference](/deployment/config-reference) topic should be used with these files.\n\n</InlineNotification>\n\n<InlineNotification kind=\"warning\">\n\nIn November 2020, Docker introduced [download rate limits](https://docs.docker.com/docker-hub/download-rate-limit/) on Docker Hub.\nThis can be mitigated by providing an Image Pull Secret to the deployment using the `global.hubPullSecret.secretName` value.\n\n</InlineNotification>\n\n### Configuring IBM MQ\n\nIBM MQ is already configured to work out of the box with a secure connection with IBM WebSphere Liberty.\nThe commands that create all the objects that are needed on the queue manager are defined in a config map, in the `configmap-mqsc.yaml` file.\n\nThe password for the IBM MQ web console can be retrieved from the created Secret resource using the following command **after** it has been deployed:\n\n```shell\nkubectl get secret <releaseName>-mq-credentials -o go-template='{{.data.adminPasswordKey | base64decode}}{{\"\\n\"}}'\n```\n\n## Packaging the Helm Charts\n\nTo use the Helm Charts to install SPM, package the charts and load them into a repository. For more information, see [ChartMuseum](/prereq/chartmuseum).\n\nFor each chart, its dependencies must be resolved before it can be loaded into a Helm repository like Chart museum.\n\n<InlineNotification>\n\nDue to a Helm [defect](https://github.com/helm/helm/issues/5780), conditional subchart enablement does not work in Helm 3.\nAs a result of this, `uawebapp` needs to be packaged and pushed, irrespective of whether you are deploying it or not.\nIt is possible to remove the dependency from the spm `chart.yaml`, if you do not wish to package and push it to the repo.\n\n</InlineNotification>\n\n<Tabs>\n\n<Tab label=\"Mac/Linux\">\n<Row>\n<Column>\n\n```shell\ncd $SPM_HOME/helm-charts\n\nhelm dependency update apps\nhelm dependency update mqserver\nhelm dependency update xmlserver\nhelm dependency update batch\nhelm dependency update web\nhelm dependency update uawebapp\n```\n\n</Column>\n</Row>\n</Tab>\n\n<Tab label=\"Windows PS\">\n<Row>\n<Column>\n\n```powershell\ncd $env:SPM_HOME\\helm-charts\\\n\nhelm dependency update apps\nhelm dependency update mqserver\nhelm dependency update xmlserver\nhelm dependency update batch\nhelm dependency update web\nhelm dependency update uawebapp\n```\n\n</Column>\n</Row>\n</Tab>\n\n</Tabs>\n\nIf you made any changes to any of the charts, these can now be verified using the `helm lint` and `helm template` commands, for example:\n\n<Tabs>\n\n<Tab label=\"Mac/Linux\">\n<Row>\n<Column>\n\n```shell\ncd $SPM_HOME/helm-charts\n\nhelm lint apps\nhelm template apps\n```\n\n</Column>\n</Row>\n</Tab>\n\n<Tab label=\"Windows PS\">\n<Row>\n<Column>\n\n```powershell\ncd $env:SPM_HOME\\helm-charts\\\n\nhelm lint apps\nhelm template apps\n```\n\n</Column>\n</Row>\n</Tab>\n\n</Tabs>\n\nTo publish the individual charts to the Chart museum repository, run the following commands from the `helm-charts` folder. The commands also use the `$SPM_HOME` value that is defined in [Install prerequisite software](/prereq/git):\n\n<InlineNotification kind=\"warning\">\n\nIn October 2021, Helm `v3.7.0` introduced a number of breaking changes, which required modifications of the tooling used in this runbook. For local development, SPM requires [chartmuseum/helm-push](https://github.com/chartmuseum/helm-push).\n\nDue to the changes introduced as part of Helm `v3.7.0` and Chart museum `v0.10.0`, when using Chartmuseum the target `helm push` has changed to `helm cm-push`\n\n</InlineNotification>\n\n<Tabs>\n\n<Tab label=\"Mac/Linux\">\n<Row>\n<Column>\n\n```shell\ncd $SPM_HOME/helm-charts\n\nhelm push apps local-development\nhelm push mqserver local-development\nhelm push xmlserver local-development\nhelm push batch local-development\nhelm push web local-development\nhelm push uawebapp local-development\n\nhelm repo update\n```\n\n</Column>\n</Row>\n</Tab>\n\n<Tab label=\"Windows PS\">\n<Row>\n<Column>\n\n```powershell\ncd $env:SPM_HOME\\helm-charts\\\n\nhelm push apps local-development\nhelm push mqserver local-development\nhelm push xmlserver local-development\nhelm push batch local-development\nhelm push web local-development\nhelm push uawebapp local-development\n\nhelm repo update\n```\n\n</Column>\n</Row>\n</Tab>\n\n</Tabs>\n\nTo generate the umbrella chart that is used for the deployment, run the following commands:\n\n<Tabs>\n\n<Tab label=\"Mac/Linux\">\n<Row>\n<Column>\n\n```shell\ncd $SPM_HOME/helm-charts\n\nhelm dependency update spm\nhelm push spm local-development\n\nhelm repo update\n```\n\n</Column>\n</Row>\n</Tab>\n\n<Tab label=\"Windows PS\">\n<Row>\n<Column>\n\n```powershell\ncd $env:SPM_HOME\\helm-charts\\\n\nhelm dependency update spm\nhelm push spm local-development\n\nhelm repo update\n```\n\n</Column>\n</Row>\n</Tab>\n\n</Tabs>\n","type":"Mdx","contentDigest":"3afbde9746ee1c59934e301b3d816931","owner":"gatsby-plugin-mdx","counter":172},"frontmatter":{"title":"Preparing Helm Charts","description":"Preparing Helm Charts"},"exports":{},"rawBody":"---\ntitle: Preparing Helm Charts\ndescription: Preparing Helm Charts\n---\n\n<InlineNotification kind=\"info\">\n\n**Troubleshooting** If you need help troubleshooting problems, see [Troubleshooting problems](/troubleshooting/troubleshoot).\n\n</InlineNotification>\n\nThe [spm-kubernetes](https://github.com/merative/spm-kubernetes) repository provides the following Helm Charts:\n\n* *apps:* defines how to deploy the IBM速 WebSphere速 Liberty images with Merative Social Program Management (SPM).\n* *batch:* defines the batch image configuration.\n* *uawebapp:* defines how to deploy the Universal Access (React) application.\n* *web:* defines how to deploy the static content image for SPM (`Curam` image only).\n* *mqserver:* defines the IBM WebSphere MQ image configuration.\n* *xmlserver:* defines the xmlserver container configuration.\n* *spm:* an umbrella chart to contain all the other charts.\n\nThe charts use a templating mechanism to create the YAML file that is used by Kubernetes.\nFor this reason, the main configuration values are stored for each chart in a `values.yaml` file in the main folder of the charts.\nThe values can also be overwritten by the `spm:*` umbrella chart or by a provided override file during deployment as described in [Deploying Helm Charts](/deployment/hc_deployment).\n\nYAML is a human-readable structured data format. It provides powerful configuration settings, without having to learn a more complex code type like CSS, JavaScript, or PHP.\n\n## Preparing to run the Helm Charts\n\nBefore you run the charts, you must configure the database, configure IBM MQ, resolve all chart dependencies, and test the charts.\nYou may also optionally integrate your deployment with an ISAM server for SSO enablement,\nto do so complete the steps on the [Enabling ISAM](/supporting-infrastructure/ISAM) page under Supporting Infrastructure before returning here.\n\nMany of the Helm Charts that make up a deployment of SPM depend on the [IBM Shared Configuration Helpers](https://github.com/IBM/charts/tree/master/samples/ibm-sch) chart, so an extra Helm repository must be added using the following command:\n\n```shell\nhelm repo add sch https://raw.githubusercontent.com/IBM/charts/master/repo/samples\nhelm repo update\n```\n\n### Configuring the Helm Chart\n\nA catalog of available configuration options is available in the [Configuration Reference](/deployment/config-reference) topic.\n\nWhile you may change the values in your local copy of `helm-charts/spm/values.yaml`, it is strongly recommended to use a values override file with your custom options.\n\n<InlineNotification>\n\nSample override files for Minikube, AKS, and CRC are also available in the `$SPM_HOME/static/resources` folder. We have provided a minimum\nspec required for a successful deployment in these files, with more options for overriding commented out. The config options from the\n[Configuration Reference](/deployment/config-reference) topic should be used with these files.\n\n</InlineNotification>\n\n<InlineNotification kind=\"warning\">\n\nIn November 2020, Docker introduced [download rate limits](https://docs.docker.com/docker-hub/download-rate-limit/) on Docker Hub.\nThis can be mitigated by providing an Image Pull Secret to the deployment using the `global.hubPullSecret.secretName` value.\n\n</InlineNotification>\n\n### Configuring IBM MQ\n\nIBM MQ is already configured to work out of the box with a secure connection with IBM WebSphere Liberty.\nThe commands that create all the objects that are needed on the queue manager are defined in a config map, in the `configmap-mqsc.yaml` file.\n\nThe password for the IBM MQ web console can be retrieved from the created Secret resource using the following command **after** it has been deployed:\n\n```shell\nkubectl get secret <releaseName>-mq-credentials -o go-template='{{.data.adminPasswordKey | base64decode}}{{\"\\n\"}}'\n```\n\n## Packaging the Helm Charts\n\nTo use the Helm Charts to install SPM, package the charts and load them into a repository. For more information, see [ChartMuseum](/prereq/chartmuseum).\n\nFor each chart, its dependencies must be resolved before it can be loaded into a Helm repository like Chart museum.\n\n<InlineNotification>\n\nDue to a Helm [defect](https://github.com/helm/helm/issues/5780), conditional subchart enablement does not work in Helm 3.\nAs a result of this, `uawebapp` needs to be packaged and pushed, irrespective of whether you are deploying it or not.\nIt is possible to remove the dependency from the spm `chart.yaml`, if you do not wish to package and push it to the repo.\n\n</InlineNotification>\n\n<Tabs>\n\n<Tab label=\"Mac/Linux\">\n<Row>\n<Column>\n\n```shell\ncd $SPM_HOME/helm-charts\n\nhelm dependency update apps\nhelm dependency update mqserver\nhelm dependency update xmlserver\nhelm dependency update batch\nhelm dependency update web\nhelm dependency update uawebapp\n```\n\n</Column>\n</Row>\n</Tab>\n\n<Tab label=\"Windows PS\">\n<Row>\n<Column>\n\n```powershell\ncd $env:SPM_HOME\\helm-charts\\\n\nhelm dependency update apps\nhelm dependency update mqserver\nhelm dependency update xmlserver\nhelm dependency update batch\nhelm dependency update web\nhelm dependency update uawebapp\n```\n\n</Column>\n</Row>\n</Tab>\n\n</Tabs>\n\nIf you made any changes to any of the charts, these can now be verified using the `helm lint` and `helm template` commands, for example:\n\n<Tabs>\n\n<Tab label=\"Mac/Linux\">\n<Row>\n<Column>\n\n```shell\ncd $SPM_HOME/helm-charts\n\nhelm lint apps\nhelm template apps\n```\n\n</Column>\n</Row>\n</Tab>\n\n<Tab label=\"Windows PS\">\n<Row>\n<Column>\n\n```powershell\ncd $env:SPM_HOME\\helm-charts\\\n\nhelm lint apps\nhelm template apps\n```\n\n</Column>\n</Row>\n</Tab>\n\n</Tabs>\n\nTo publish the individual charts to the Chart museum repository, run the following commands from the `helm-charts` folder. The commands also use the `$SPM_HOME` value that is defined in [Install prerequisite software](/prereq/git):\n\n<InlineNotification kind=\"warning\">\n\nIn October 2021, Helm `v3.7.0` introduced a number of breaking changes, which required modifications of the tooling used in this runbook. For local development, SPM requires [chartmuseum/helm-push](https://github.com/chartmuseum/helm-push).\n\nDue to the changes introduced as part of Helm `v3.7.0` and Chart museum `v0.10.0`, when using Chartmuseum the target `helm push` has changed to `helm cm-push`\n\n</InlineNotification>\n\n<Tabs>\n\n<Tab label=\"Mac/Linux\">\n<Row>\n<Column>\n\n```shell\ncd $SPM_HOME/helm-charts\n\nhelm push apps local-development\nhelm push mqserver local-development\nhelm push xmlserver local-development\nhelm push batch local-development\nhelm push web local-development\nhelm push uawebapp local-development\n\nhelm repo update\n```\n\n</Column>\n</Row>\n</Tab>\n\n<Tab label=\"Windows PS\">\n<Row>\n<Column>\n\n```powershell\ncd $env:SPM_HOME\\helm-charts\\\n\nhelm push apps local-development\nhelm push mqserver local-development\nhelm push xmlserver local-development\nhelm push batch local-development\nhelm push web local-development\nhelm push uawebapp local-development\n\nhelm repo update\n```\n\n</Column>\n</Row>\n</Tab>\n\n</Tabs>\n\nTo generate the umbrella chart that is used for the deployment, run the following commands:\n\n<Tabs>\n\n<Tab label=\"Mac/Linux\">\n<Row>\n<Column>\n\n```shell\ncd $SPM_HOME/helm-charts\n\nhelm dependency update spm\nhelm push spm local-development\n\nhelm repo update\n```\n\n</Column>\n</Row>\n</Tab>\n\n<Tab label=\"Windows PS\">\n<Row>\n<Column>\n\n```powershell\ncd $env:SPM_HOME\\helm-charts\\\n\nhelm dependency update spm\nhelm push spm local-development\n\nhelm repo update\n```\n\n</Column>\n</Row>\n</Tab>\n\n</Tabs>\n","fileAbsolutePath":"/home/runner/work/spm-kubernetes/spm-kubernetes/src/pages/deployment/hc_preparation.mdx"}}},"staticQueryHashes":["1364590287","137577622","2102389209","2456312558","2746626797","3018647132","3037994772","56986546","768070550"]}